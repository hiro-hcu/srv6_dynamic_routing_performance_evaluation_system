# SRv6 Multi-Table Manager é–¢æ•°åˆ†æï¼ˆå¯è¦–åŒ–å¯¾å¿œç‰ˆï¼‰

## ğŸ“Š ãƒ—ãƒ­ã‚°ãƒ©ãƒ æ§‹é€ æ¦‚è¦ï¼ˆæœ€æ–°ç‰ˆï¼‰

### ğŸ—ï¸ ã‚¯ãƒ©ã‚¹è¨­è¨ˆ - å˜ä¸€è²¬ä»»åŸå‰‡ã«åŸºã¥ãåˆ†é›¢

#### ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹
- **SRv6Config**: çµ±åˆè¨­å®šç®¡ç†ï¼ˆSSHã€ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã€ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã€RRDãƒ‘ã‚¹ï¼‰
- **TableRoute**: ãƒ†ãƒ¼ãƒ–ãƒ«çµŒè·¯æƒ…å ±ï¼ˆãƒ‘ã‚¹ã€SIDã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€ã‚³ã‚¹ãƒˆï¼‰
- **PathChangeEvent**: çµŒè·¯å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²

#### æ©Ÿèƒ½åˆ¥ã‚¯ãƒ©ã‚¹
- **RRDDataManager**: RRDãƒ‡ãƒ¼ã‚¿å–å¾—ã¨ã‚¨ãƒƒã‚¸é‡ã¿æ›´æ–°ï¼ˆåˆ©ç”¨ç‡ãƒ™ãƒ¼ã‚¹ï¼‰
- **PathCalculator**: çµŒè·¯è¨ˆç®—ã¨SIDãƒªã‚¹ãƒˆç”Ÿæˆï¼ˆDijkstraæ³•+é‡ã¿å€ç‡ï¼‰
- **TopologyVisualizer**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒãƒ­ã‚¸å¯è¦–åŒ–ï¼ˆNetworkX+matplotlibï¼‰
- **SSHConnectionManager**: SSHæ¥ç¶šã¨ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
- **RoutingTableManager**: ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°

#### ãƒ¡ã‚¤ãƒ³ã‚¯ãƒ©ã‚¹
- **SRv6PathManager**: åŒæ–¹å‘ãƒ‘ã‚¹ç®¡ç†+å¯è¦–åŒ–æ©Ÿèƒ½ï¼ˆç°¡ç´ åŒ–ç‰ˆï¼‰
- **SRv6RealTimeMultiTableManager**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ï¼ˆç°¡ç´ åŒ–ç‰ˆã€äº’æ›æ€§ç¶­æŒï¼‰

## ğŸ”„ æœ€é©åŒ–å¾Œã®é–¢æ•°ä¾å­˜é–¢ä¿‚å›³

```
main()
â”œâ”€â”€ SRv6PathManager (åŒæ–¹å‘ãƒ¢ãƒ¼ãƒ‰ + å¯è¦–åŒ–)
â”‚   â”œâ”€â”€ RRDDataManager.update_edge_weights()
â”‚   â”‚   â””â”€â”€ fetch_rrd_data() [å…¨ã‚¨ãƒƒã‚¸ã«å¯¾ã—ã¦å®Ÿè¡Œ]
â”‚   â”œâ”€â”€ PathCalculator.calculate_multiple_paths()
â”‚   â”‚   â””â”€â”€ path_to_sid_list() [å„çµŒè·¯ã«å¯¾ã—ã¦å®Ÿè¡Œ]
â”‚   â”œâ”€â”€ SRv6PathManager.create_table_routes()
â”‚   â”‚   â””â”€â”€ è¨ˆç®—æ¸ˆã¿ã®çµŒè·¯æƒ…å ±(self.calculated_paths)ã‚’ä½¿ç”¨
â”‚   â”œâ”€â”€ RoutingTableManager.update_all_tables()
â”‚   â”‚   â”œâ”€â”€ SSHConnectionManager.r1_connection() [å¾€è·¯]
â”‚   â”‚   â”œâ”€â”€ SSHConnectionManager.r16_connection() [å¾©è·¯]
â”‚   â”‚   â””â”€â”€ SSHConnectionManager.execute_command()
â”‚   â””â”€â”€ TopologyVisualizer.visualize()
â”‚       â””â”€â”€ ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜(/opt/app/visualization/topology_latest.png)
â”‚
â””â”€â”€ SRv6RealTimeMultiTableManager (å¾€è·¯ã®ã¿ãƒ¢ãƒ¼ãƒ‰ã€äº’æ›æ€§ç¶­æŒ)
    â””â”€â”€ real_time_monitor()
        â”œâ”€â”€ display_status()
        â”œâ”€â”€ detect_path_changes()
        â”œâ”€â”€ log_path_changes()
        â””â”€â”€ [ä¸Šè¨˜æ©Ÿèƒ½ã‚¯ãƒ©ã‚¹ã‚’å§”è­²ã—ã¦ä½¿ç”¨]
```

## ğŸ”„ ã‚¨ãƒƒã‚¸é‡ã¿ã¥ã‘ã‹ã‚‰çµŒè·¯æ±ºå®šã¾ã§ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼

### æ¦‚è¦
åˆ©ç”¨ç‡ãƒ™ãƒ¼ã‚¹ã®é‡ã¿ã¥ã‘ã¨Dijkstraæ³•ã«ã‚ˆã‚‹è¤‡æ•°çµŒè·¯é¸æŠã‚’å®Ÿè¡Œã—ã€å„ªå…ˆåº¦ã«å¿œã˜ãŸ3ã¤ã®ç•°ãªã‚‹çµŒè·¯ã‚’æ±ºå®šã—ã¾ã™ã€‚

### ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ

```
[1] ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒãƒ­ã‚¸åˆæœŸåŒ–
    â”‚
    â”œâ”€ PathCalculator._create_topology()
    â”‚   â”œâ”€ 16ãƒãƒ¼ãƒ‰ï¼ˆr1ã€œr16ï¼‰ã‚’4x4æ ¼å­çŠ¶ã«é…ç½®
    â”‚   â””â”€ 24ã‚¨ãƒƒã‚¸ä½œæˆï¼ˆå„ã‚¨ãƒƒã‚¸ã« max_bandwidth=125,000,000 Bytes/s ã‚’è¨­å®šï¼‰
    â”‚       â””â”€ åˆæœŸé‡ã¿: 0.0001ï¼ˆæœ€å°å€¤ã€å…¨ã‚¨ãƒƒã‚¸ï¼‰
    â”‚
[2] RRDãƒ‡ãƒ¼ã‚¿å–å¾—ã¨ã‚¨ãƒƒã‚¸é‡ã¿æ›´æ–°
    â”‚
    â”œâ”€ RRDDataManager.update_edge_weights(graph)
    â”‚   â”‚
    â”‚   â””â”€ å…¨ã‚¨ãƒƒã‚¸ã«å¯¾ã—ã¦ãƒ«ãƒ¼ãƒ—:
    â”‚       â”œâ”€ fetch_rrd_data(rrd_path) â†’ ãƒ‡ãƒ¼ã‚¿è»¢é€é‡å–å¾— [Bytes/s]
    â”‚       â”œâ”€ åˆ©ç”¨ç‡è¨ˆç®—: u = ãƒ‡ãƒ¼ã‚¿è»¢é€é‡ / max_bandwidth
    â”‚       â”‚   â””â”€ ç¯„å›²åˆ¶é™: max(0.0, min(1.0, u))  # 0ã€œ1ã®ç¯„å›²
    â”‚       â””â”€ graph[u][v]['weight'] = max(u, 0.0001)  # æœ€å°é‡ã¿ä¿è¨¼
    â”‚           â””â”€ ãƒ‡ãƒ¼ã‚¿ãªã—ã§ã‚‚0.0001ã‚’è¨­å®šï¼ˆçµŒè·¯å¤šæ§˜æ€§ç¢ºä¿ï¼‰
    â”‚
[3] è¤‡æ•°çµŒè·¯è¨ˆç®—ï¼ˆå„ªå…ˆåº¦åˆ¥ã€é‡è¤‡è¨ˆç®—ã®æ’é™¤ï¼‰
    â”‚
    â”œâ”€ PathCalculator.calculate_multiple_paths(src=1, dst=16, num_paths=3, verbose=True)
    â”‚   â”‚
    â”‚   â”œâ”€ temp_graph = self.graph.copy()  # ä½œæ¥­ç”¨ã‚°ãƒ©ãƒ•
    â”‚   â”œâ”€ weight_multipliers = [3.0, 2.0, 1.0]  # é«˜ãƒ»ä¸­ãƒ»ä½å„ªå…ˆåº¦
    â”‚   â”‚
    â”‚   â””â”€ for i in range(3):  # 3çµŒè·¯è¨ˆç®—
    â”‚       â”‚
    â”‚       â”œâ”€ [3-1] Dijkstraæ³•ã§æœ€çŸ­çµŒè·¯è¨ˆç®—
    â”‚       â”‚   â”œâ”€ path = nx.shortest_path(temp_graph, src, dst, weight='weight')
    â”‚       â”‚   â””â”€ cost = nx.shortest_path_length(temp_graph, src, dst, weight='weight')
    â”‚       â”‚       â””â”€ ã‚³ã‚¹ãƒˆ = çµŒè·¯ä¸Šã®å…¨ã‚¨ãƒƒã‚¸é‡ã¿ã®åˆè¨ˆ
    â”‚       â”‚
    â”‚       â”œâ”€ [3-2] çµŒè·¯ã‚’ãƒªã‚¹ãƒˆã«è¿½åŠ 
    â”‚       â”‚   â””â”€ paths.append((path, cost))
    â”‚       â”‚
    â”‚       â”œâ”€ [3-3] è©³ç´°ãƒ­ã‚°å‡ºåŠ›ï¼ˆverbose=Trueã®å ´åˆã®ã¿ï¼‰
    â”‚       â”‚   â”œâ”€ çµŒè·¯ç•ªå·ã€å„ªå…ˆåº¦ã€ãƒãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã€ç·ã‚³ã‚¹ãƒˆ
    â”‚       â”‚   â””â”€ å„ã‚¨ãƒƒã‚¸ã®ã‚³ã‚¹ãƒˆï¼ˆ"Edge r{u}-r{v}: ã‚³ã‚¹ãƒˆ={cost:.6f}"ï¼‰
    â”‚       â”‚
    â”‚       â””â”€ [3-4] æ¬¡å›è¨ˆç®—ç”¨ã«ä½¿ç”¨ã‚¨ãƒƒã‚¸ã®é‡ã¿ã‚’å¢—åŠ 
    â”‚           â””â”€ if i < 2:  # 1ã¤ç›®ã¨2ã¤ç›®ã®çµŒè·¯ã®ã¿
    â”‚               â””â”€ çµŒè·¯ä¸Šã®å„ã‚¨ãƒƒã‚¸:
    â”‚                   â”œâ”€ 1ã¤ç›®ï¼ˆi=0ï¼‰: é‡ã¿ Ã— 3.0
    â”‚                   â”œâ”€ 2ã¤ç›®ï¼ˆi=1ï¼‰: é‡ã¿ Ã— 2.0
    â”‚                   â””â”€ temp_graph[u][v]['weight'] = æ–°é‡ã¿ï¼ˆä¸Šé™ãªã—ï¼‰
    â”‚
[4] çµŒè·¯ã‹ã‚‰SRv6ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒªã‚¹ãƒˆç”Ÿæˆ
    â”‚
    â””â”€ PathCalculator.path_to_sid_list(path, is_return=False)
        â”‚
        â””â”€ çµŒè·¯ã®å„ãƒ›ãƒƒãƒ—ã«å¯¾ã—ã¦:
            â”œâ”€ forward_segments ã‹ã‚‰ (SID, interface) ã‚’å–å¾—
            â”œâ”€ sid_list.append(segment)
            â””â”€ interface_list.append(interface)
            
[5] ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ«ãƒ¼ãƒˆç”Ÿæˆï¼ˆè¨ˆç®—æ¸ˆã¿çµŒè·¯ã®å†åˆ©ç”¨ï¼‰
    â”‚
    â””â”€ SRv6PathManager.create_table_routes(optimal_path)
        â”‚
        â””â”€ self.calculated_paths ã‚’ä½¿ç”¨ï¼ˆå†è¨ˆç®—ãªã—ï¼‰
            â”œâ”€ å„å„ªå…ˆåº¦ã«å¯¾ã—ã¦TableRouteã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ
            â”‚   â”œâ”€ table_name: rt_table1/2/3
            â”‚   â”œâ”€ path: ãƒãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ
            â”‚   â”œâ”€ segments: SIDãƒªã‚¹ãƒˆ
            â”‚   â”œâ”€ interfaces: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒªã‚¹ãƒˆ
            â”‚   â”œâ”€ output_interface: æœ€åˆã®ãƒ›ãƒƒãƒ—ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
            â”‚   â””â”€ cost: çµŒè·¯ã‚³ã‚¹ãƒˆ
            â””â”€ å¾©è·¯ã®å ´åˆã‚‚åŒæ§˜ï¼ˆverbose=Falseã§å‡ºåŠ›æŠ‘åˆ¶ï¼‰

[6] å¯è¦–åŒ–ï¼ˆ--visualizeã‚ªãƒ—ã‚·ãƒ§ãƒ³æœ‰åŠ¹æ™‚ï¼‰
    â”‚
    â””â”€ TopologyVisualizer.visualize(paths, update_count)
        â”‚
        â”œâ”€ æ ¼å­çŠ¶ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã§ãƒãƒ¼ãƒ‰é…ç½®ï¼ˆ4x4ï¼‰
        â”œâ”€ å…¨ã‚¨ãƒƒã‚¸ã‚’ç°è‰²ã§æç”»
        â”œâ”€ ã‚¨ãƒƒã‚¸ãƒ©ãƒ™ãƒ«è¡¨ç¤º: "U:{utilization}\nC:{cost}"
        â”œâ”€ é¸æŠã•ã‚ŒãŸ3çµŒè·¯ã‚’è‰²åˆ†ã‘æç”»
        â”‚   â”œâ”€ é«˜å„ªå…ˆåº¦: èµ¤ï¼ˆå¹…4ï¼‰
        â”‚   â”œâ”€ ä¸­å„ªå…ˆåº¦: ã‚ªãƒ¬ãƒ³ã‚¸ï¼ˆå¹…3ï¼‰
        â”‚   â””â”€ ä½å„ªå…ˆåº¦: ç·‘ï¼ˆå¹…2ï¼‰
        â”œâ”€ å‡¡ä¾‹ã«çµŒè·¯æƒ…å ±è¡¨ç¤ºï¼ˆç·ã‚³ã‚¹ãƒˆã€å¹³å‡ã‚¨ãƒƒã‚¸ã‚³ã‚¹ãƒˆï¼‰
        â””â”€ PNGç”»åƒã¨ã—ã¦ä¿å­˜: /opt/app/visualization/topology_latest.png
```
            â””â”€ interface_list.append(interface)
```

### å…·ä½“ä¾‹: 3çµŒè·¯ã®æ±ºå®šãƒ—ãƒ­ã‚»ã‚¹

#### åˆæœŸçŠ¶æ…‹
```
ã‚¨ãƒƒã‚¸åˆ©ç”¨ç‡ï¼ˆRRDãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å–å¾—ã€æœ€å°å€¤0.0001ä¿è¨¼ï¼‰:
  r1-r2: 0.0001 (ãƒ‡ãƒ¼ã‚¿ãªã—)  r1-r3: 0.0001 (ãƒ‡ãƒ¼ã‚¿ãªã—)
  r2-r5: 0.0001 (ãƒ‡ãƒ¼ã‚¿ãªã—)  r3-r5: 0.0001 (ãƒ‡ãƒ¼ã‚¿ãªã—)
  ... (å…¨ã‚¨ãƒƒã‚¸ãŒ0.0001ã‹ã‚‰é–‹å§‹)

â€» RRDãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã‚„ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãŒ0ã§ã‚‚ã€
  æœ€å°é‡ã¿0.0001ã«ã‚ˆã‚ŠçµŒè·¯ã®å¤šæ§˜æ€§ãŒç¢ºä¿ã•ã‚Œã‚‹
```

#### çµŒè·¯1ï¼ˆé«˜å„ªå…ˆåº¦ï¼‰ã®æ±ºå®š
```
1. Dijkstraæ³•å®Ÿè¡Œï¼ˆåˆæœŸé‡ã¿ = 0.0001ï¼‰
   â†’ å…¨ã‚¨ãƒƒã‚¸ãŒåŒã˜é‡ã¿ã®ãŸã‚ã€æœ€çŸ­ãƒ›ãƒƒãƒ—æ•°ã®çµŒè·¯ãŒé¸æŠã•ã‚Œã‚‹
   â†’ æœ€å°ã‚³ã‚¹ãƒˆãƒ‘ã‚¹: r1 â†’ r3 â†’ r6 â†’ r10 â†’ r13 â†’ r15 â†’ r16
   â†’ ã‚³ã‚¹ãƒˆ: 0.0001 Ã— 6 = 0.0006

2. ä½¿ç”¨ã‚¨ãƒƒã‚¸ã®é‡ã¿æ›´æ–°ï¼ˆÃ—3.0ï¼‰
   r1-r3: 0.0001 â†’ 0.0003
   r3-r6: 0.0001 â†’ 0.0003
   r6-r10: 0.0001 â†’ 0.0003
   r10-r13: 0.0001 â†’ 0.0003
   r13-r15: 0.0001 â†’ 0.0003
   r15-r16: 0.0001 â†’ 0.0003
```

#### çµŒè·¯2ï¼ˆä¸­å„ªå…ˆåº¦ï¼‰ã®æ±ºå®š
```
1. Dijkstraæ³•å®Ÿè¡Œï¼ˆæ›´æ–°å¾Œã®é‡ã¿ä½¿ç”¨ï¼‰
   â†’ çµŒè·¯1ã§é‡ã¿ãŒ3å€ã«ãªã£ãŸãŸã‚ã€åˆ¥çµŒè·¯ãŒé¸æŠã•ã‚Œã‚‹
   â†’ æœ€å°ã‚³ã‚¹ãƒˆãƒ‘ã‚¹: r1 â†’ r2 â†’ r5 â†’ r9 â†’ r13 â†’ r15 â†’ r16
   â†’ ã‚³ã‚¹ãƒˆ: 0.0001 Ã— 5 + 0.0003 Ã— 2 = 0.0011
   ï¼ˆr13-r15ã¨r15-r16ã¯çµŒè·¯1ã¨å…±æœ‰ï¼‰

2. ä½¿ç”¨ã‚¨ãƒƒã‚¸ã®é‡ã¿æ›´æ–°ï¼ˆÃ—2.0ï¼‰
   r1-r2: 0.0001 â†’ 0.0002
   r2-r5: 0.0001 â†’ 0.0002
   r5-r9: 0.0001 â†’ 0.0002
   r9-r13: 0.0001 â†’ 0.0002
   r13-r15: 0.0003 â†’ 0.0006 (ã•ã‚‰ã«2å€)
   r15-r16: 0.0003 â†’ 0.0006 (ã•ã‚‰ã«2å€)
```

#### çµŒè·¯3ï¼ˆä½å„ªå…ˆåº¦ï¼‰ã®æ±ºå®š
```
1. Dijkstraæ³•å®Ÿè¡Œï¼ˆã•ã‚‰ã«æ›´æ–°å¾Œã®é‡ã¿ä½¿ç”¨ï¼‰
   â†’ çµŒè·¯1ãƒ»2ã§é‡ã¿ãŒå¢—åŠ ã—ãŸãŸã‚ã€ã•ã‚‰ã«åˆ¥çµŒè·¯ãŒé¸æŠã•ã‚Œã‚‹
   â†’ æœ€å°ã‚³ã‚¹ãƒˆãƒ‘ã‚¹: r1 â†’ r2 â†’ r4 â†’ r7 â†’ r11 â†’ r14 â†’ r16
   â†’ ã‚³ã‚¹ãƒˆ: 0.0002 + 0.0001 Ã— 5 = 0.0007
   ï¼ˆr1-r2ã¯çµŒè·¯2ã§2å€ã€æ®‹ã‚Šã¯æœªä½¿ç”¨ï¼‰

2. é‡ã¿æ›´æ–°ãªã—ï¼ˆæœ€å¾Œã®çµŒè·¯ï¼‰
```

#### å®Ÿãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãŒã‚ã‚‹å ´åˆã®ä¾‹
```
ã‚¨ãƒƒã‚¸åˆ©ç”¨ç‡ï¼ˆRRDãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å–å¾—ï¼‰:
  r1-r2: 0.05 (5%ä½¿ç”¨)   r1-r3: 0.10 (10%ä½¿ç”¨)
  r2-r5: 0.08 (8%ä½¿ç”¨)   r3-r5: 0.03 (3%ä½¿ç”¨)
  r5-r9: 0.12 (12%ä½¿ç”¨)  r6-r10: 0.02 (2%ä½¿ç”¨)
  ... (ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã«å¿œã˜ãŸåˆ©ç”¨ç‡)

â†’ ä½è² è·ãƒªãƒ³ã‚¯ã‚’å„ªå…ˆçš„ã«é¸æŠ
â†’ çµŒè·¯1ã§ä½¿ç”¨ã—ãŸãƒªãƒ³ã‚¯ã¯é‡ã¿ãŒ3å€ã«ãªã‚Šã€çµŒè·¯2ãƒ»3ã§ã¯å›é¿ã•ã‚Œã‚‹å‚¾å‘
```

### é‡ã¿ã¥ã‘ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ç‰¹å¾´

#### åˆ©ç”¨ç‡ã®æ­£è¦åŒ–ï¼ˆ0-1ã®ç¯„å›²ï¼‰
```python
# ãƒ‡ãƒ¼ã‚¿è»¢é€é‡ã‹ã‚‰åˆ©ç”¨ç‡ã‚’è¨ˆç®—
utilization = ãƒ‡ãƒ¼ã‚¿è»¢é€é‡ (Bytes/s) / æœ€å¤§å¸¯åŸŸå¹… (125,000,000 Bytes/s)
utilization = max(0.0, min(1.0, utilization))  # 0ã€œ1ã«ã‚¯ãƒªãƒƒãƒ—
```

#### æœ€å°é‡ã¿ä¿è¨¼ï¼ˆ0.0001ï¼‰
```python
# æœ€å°é‡ã¿å€¤ã‚’ä¿è¨¼ï¼ˆåˆ©ç”¨ç‡ãŒ0ã§ã‚‚çµŒè·¯é¸æŠã®å¤šæ§˜æ€§ã‚’ä¿ã¤ï¼‰
min_weight = 0.0001
graph[u][v]['weight'] = max(utilization, min_weight)

# ã“ã‚Œã«ã‚ˆã‚Šä»¥ä¸‹ã®åŠ¹æœãŒå¾—ã‚‰ã‚Œã‚‹:
# 1. ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãŒ0ã§ã‚‚é‡ã¿ãŒ0ã«ãªã‚‰ãªã„
# 2. RRDãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—æ™‚ã‚‚æœ€å°é‡ã¿ã§å‹•ä½œç¶™ç¶š
# 3. é‡ã¿å€ç‡é©ç”¨æ™‚ã‚‚éã‚¼ãƒ­ã®å€¤ãŒä¿è¨¼ã•ã‚Œã‚‹
# 4. 3ã¤ã®çµŒè·¯ãŒå¿…ãšç•°ãªã‚‹çµŒè·¯ã‚’é¸æŠã§ãã‚‹
```

#### é‡ã¿ã®å€ç‡é©ç”¨ï¼ˆä¸Šé™ãªã—ï¼‰
```python
# çµŒè·¯é¸æŠå¾Œã€ä½¿ç”¨ã‚¨ãƒƒã‚¸ã®é‡ã¿ã‚’å¢—åŠ 
new_weight = old_weight * multiplier  # ä¸Šé™åˆ¶é™ãªã—

# ä¾‹: æœ€å°é‡ã¿0.0001ã®ãƒªãƒ³ã‚¯ã®å ´åˆ
# - 1å›ç›®ä½¿ç”¨å¾Œ: 0.0001 Ã— 3.0 = 0.0003
# - 2å›ç›®ä½¿ç”¨å¾Œ: 0.0003 Ã— 2.0 = 0.0006

# ä¾‹: åˆ©ç”¨ç‡0.5ã®ãƒªãƒ³ã‚¯ã®å ´åˆ
# - 1å›ç›®ä½¿ç”¨å¾Œ: 0.5 Ã— 3.0 = 1.5 (1.0ã‚’è¶…ãˆã‚‹)
# - 2å›ç›®ä½¿ç”¨å¾Œ: 1.5 Ã— 2.0 = 3.0 (ã•ã‚‰ã«å¢—åŠ )
```

#### çµŒè·¯ã®å¤šæ§˜æ€§ç¢ºä¿ãƒ¡ã‚«ãƒ‹ã‚ºãƒ 
- **1ã¤ç›®ï¼ˆé«˜å„ªå…ˆåº¦ï¼‰**: æœ€ã‚‚ä½è² è·ãªçµŒè·¯ã‚’é¸æŠï¼ˆåˆ©ç”¨ç‡ãƒ™ãƒ¼ã‚¹ï¼‰
- **2ã¤ç›®ï¼ˆä¸­å„ªå…ˆåº¦ï¼‰**: 1ã¤ç›®ã§ä½¿ç”¨ã—ãŸãƒªãƒ³ã‚¯ã‚’é¿ã‘ã‚‹å‚¾å‘ï¼ˆé‡ã¿3å€ã®ãƒšãƒŠãƒ«ãƒ†ã‚£ï¼‰
- **3ã¤ç›®ï¼ˆä½å„ªå…ˆåº¦ï¼‰**: 1ã¤ç›®ãƒ»2ã¤ç›®ã§ä½¿ç”¨ã—ãŸãƒªãƒ³ã‚¯ã‚’é¿ã‘ã‚‹å‚¾å‘ï¼ˆé‡ã¿3å€+2å€ã®ãƒšãƒŠãƒ«ãƒ†ã‚£ï¼‰

#### ãƒ­ã‚°å‡ºåŠ›ã®æœ€é©åŒ–
- **å¾€è·¯ï¼ˆverbose=Trueï¼‰**: è©³ç´°ãªçµŒè·¯æƒ…å ±ã¨ã‚¨ãƒƒã‚¸ã‚³ã‚¹ãƒˆã‚’å‡ºåŠ›
- **å¾©è·¯ï¼ˆverbose=Falseï¼‰**: å‡ºåŠ›ã‚’æŠ‘åˆ¶ã—ã€ãƒ­ã‚°ã®è¦‹ã‚„ã™ã•ã‚’å‘ä¸Š
- **é‡è¤‡è¨ˆç®—ã®æ’é™¤**: è¨ˆç®—æ¸ˆã¿ã®çµŒè·¯æƒ…å ±ã‚’å†åˆ©ç”¨ï¼ˆself.calculated_pathsï¼‰

---

## ğŸ“‹ ã‚¯ãƒ©ã‚¹åˆ¥æ©Ÿèƒ½è§£æ

### ğŸ—„ï¸ RRDDataManager

#### `__init__(config)`
- **ç›®çš„**: RRDãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹è¨­å®šã®ç®¡ç†
- **ä¾å­˜**: SRv6Configï¼ˆRRDãƒ‘ã‚¹è¨­å®šï¼‰
- **åˆæœŸåŒ–**: RRDãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚°ã€å–å¾—ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼

#### `update_edge_weights(graph)`
- **ç›®çš„**: RRDãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãã‚¨ãƒƒã‚¸é‡ã¿æ›´æ–°ï¼ˆåˆ©ç”¨ç‡ãƒ™ãƒ¼ã‚¹ï¼‰
- **ä¾å­˜é–¢æ•°**: `fetch_rrd_data()`
- **å½±éŸ¿**: ã‚°ãƒ©ãƒ•å…¨ä½“ã®æœ€çŸ­çµŒè·¯è¨ˆç®—ã«å½±éŸ¿
- **å®Ÿè¡Œé »åº¦**: 60ç§’é–“éš”ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
- **æœ€å°é‡ã¿ä¿è¨¼**: max(utilization, 0.0001) ã«ã‚ˆã‚ŠçµŒè·¯å¤šæ§˜æ€§ã‚’ç¢ºä¿

#### `fetch_rrd_data(rrd_path)`
- **ç›®çš„**: RRDãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯æƒ…å ±å–å¾—
- **æˆ»ã‚Šå€¤**: ãƒ‡ãƒ¼ã‚¿è»¢é€é‡ï¼ˆBytes/sï¼‰ã¾ãŸã¯ None
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: Noneè¿”å´æ™‚ã¯å‘¼ã³å‡ºã—å…ƒã§æœ€å°é‡ã¿0.0001ã‚’è¨­å®š

### ğŸ§® PathCalculator

#### `__init__(config)`
- **ç›®çš„**: çµŒè·¯è¨ˆç®—ç”¨ã®è¨­å®šã¨ãƒˆãƒãƒ­ã‚¸ãƒ¼ç®¡ç†
- **ä¾å­˜**: SRv6Configï¼ˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ï¼‰
- **ãƒˆãƒãƒ­ã‚¸ãƒ¼**: 4x4æ ¼å­çŠ¶ã€16ãƒãƒ¼ãƒ‰ã€24ã‚¨ãƒƒã‚¸

#### `_create_topology()`
- **ç›®çš„**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒãƒ­ã‚¸ãƒ¼ä½œæˆ
- **æ§‹é€ **: NetworkXã‚°ãƒ©ãƒ•ï¼ˆç„¡å‘ã‚°ãƒ©ãƒ•ï¼‰
- **åˆæœŸé‡ã¿**: 0.0001ï¼ˆå…¨ã‚¨ãƒƒã‚¸ï¼‰
- **å¸¯åŸŸå¹…**: 125,000,000 Bytes/sï¼ˆ1Gbpsï¼‰

#### `calculate_multiple_paths(src, dst, num_paths=3, verbose=True)`
- **ç›®çš„**: è¤‡æ•°çµŒè·¯å€™è£œã®ç”Ÿæˆï¼ˆé‡ã¿å€ç‡é©ç”¨ï¼‰
- **ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **: Dijkstraæ³• + é‡ã¿å€ç‡ï¼ˆ3.0, 2.0, 1.0ï¼‰
- **æˆ»ã‚Šå€¤**: [(ãƒ‘ã‚¹, ã‚³ã‚¹ãƒˆ), ...] ã®ãƒªã‚¹ãƒˆ
- **ä¾å­˜**: æ›´æ–°ã•ã‚ŒãŸã‚°ãƒ©ãƒ•ãƒˆãƒãƒ­ã‚¸ãƒ¼ã¨ã‚¨ãƒƒã‚¸é‡ã¿
- **verbose**: Trueã§è©³ç´°ãƒ­ã‚°ã€Falseã§å‡ºåŠ›æŠ‘åˆ¶ï¼ˆå¾©è·¯ç”¨ï¼‰

#### `path_to_sid_list(path, is_return=False)`
- **ç›®çš„**: ãƒãƒ¼ãƒ‰ãƒ‘ã‚¹ã‚’SRv6ã‚»ã‚°ãƒ¡ãƒ³ãƒˆIDãƒªã‚¹ãƒˆã«å¤‰æ›
- **å¤‰æ›ãƒ«ãƒ¼ãƒ«**: å„ãƒ›ãƒƒãƒ—ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å–å¾—
- **æˆ»ã‚Šå€¤**: (SIDãƒªã‚¹ãƒˆ, ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒªã‚¹ãƒˆ, å‡ºåŠ›ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹)

### ğŸ¨ TopologyVisualizer

#### `__init__(graph, output_dir="/opt/app/visualization")`
- **ç›®çš„**: å¯è¦–åŒ–æ©Ÿèƒ½ã®åˆæœŸåŒ–
- **ä¾å­˜**: NetworkXã‚°ãƒ©ãƒ•ã€matplotlibï¼ˆAggãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰
- **å‡ºåŠ›å…ˆ**: æŒ‡å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: /opt/app/visualizationï¼‰
- **ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**: 4x4æ ¼å­çŠ¶é…ç½®

#### `_setup_figure()`
- **ç›®çš„**: å›³ã®åˆæœŸè¨­å®šã¨ãƒãƒ¼ãƒ‰ä½ç½®æ±ºå®š
- **ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**: æ‰‹å‹•ã§æ ¼å­çŠ¶é…ç½®ï¼ˆ4è¡Œ4åˆ—ï¼‰
  ```
  r1   r2   r4   r7   (ä¸Šæ®µ)
  r3   r5   r8   r11  (2æ®µç›®)
  r6   r9   r12  r14  (3æ®µç›®)
  r10  r13  r15  r16  (ä¸‹æ®µ)
  ```

#### `visualize(paths=None, update_count=0)`
- **ç›®çš„**: ãƒˆãƒãƒ­ã‚¸ã€ã‚¨ãƒƒã‚¸é‡ã¿ã€é¸æŠçµŒè·¯ã®å¯è¦–åŒ–
- **è¡¨ç¤ºå†…å®¹**:
  - å…¨ãƒãƒ¼ãƒ‰ï¼ˆæ°´è‰²ã€ãƒ©ãƒ™ãƒ«ä»˜ãï¼‰
  - å…¨ã‚¨ãƒƒã‚¸ï¼ˆç°è‰²ã€ç´°ç·šï¼‰
  - ã‚¨ãƒƒã‚¸ãƒ©ãƒ™ãƒ«: "U:{åˆ©ç”¨ç‡}\nC:{ã‚³ã‚¹ãƒˆ}"
  - é¸æŠçµŒè·¯: èµ¤ï¼ˆé«˜ï¼‰ã€ã‚ªãƒ¬ãƒ³ã‚¸ï¼ˆä¸­ï¼‰ã€ç·‘ï¼ˆä½ï¼‰
  - å‡¡ä¾‹: çµŒè·¯åã€ç·ã‚³ã‚¹ãƒˆã€å¹³å‡ã‚¨ãƒƒã‚¸ã‚³ã‚¹ãƒˆ
- **å‡ºåŠ›**: topology_latest.png ã¨ã—ã¦ä¿å­˜

#### `close()`
- **ç›®çš„**: å›³ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- **å‡¦ç†**: matplotlibå›³ã‚’é–‰ã˜ã¦ãƒ¡ãƒ¢ãƒªè§£æ”¾

### ğŸ”— SSHConnectionManager

#### `__init__(config)`
- **ç›®çš„**: SSHæ¥ç¶šæƒ…å ±ã®è¨­å®šç®¡ç†
- **ä¾å­˜**: SRv6Configï¼ˆãƒ›ã‚¹ãƒˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‰

#### `r1_connection()` / `r6_connection()`
- **ç›®çš„**: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã«ã‚ˆã‚‹å®‰å…¨ãªSSHæ¥ç¶š
- **æˆ»ã‚Šå€¤**: paramiko.SSHClientã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: æ¥ç¶šå¤±æ•—æ™‚ã®é©åˆ‡ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

#### `execute_command(ssh, command)`
- **ç›®çš„**: SSHã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã¨çµæœå–å¾—
- **æˆ»ã‚Šå€¤**: (stdout, stderr, exit_status)ã‚¿ãƒ—ãƒ«
- **ãƒ­ã‚°å‡ºåŠ›**: ã‚³ãƒãƒ³ãƒ‰ã¨å®Ÿè¡Œçµæœã®è©³ç´°

### ğŸ“‹ RoutingTableManager

#### `__init__(config)`
- **ç›®çš„**: ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«æ“ä½œã®è¨­å®šç®¡ç†
- **ä¾å­˜**: SRv6Configï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ï¼‰

#### `create_table_routes(path, is_return=False)`
- **ç›®çš„**: çµŒè·¯ã‹ã‚‰è¤‡æ•°ã®TableRouteã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ
- **å¤‰æ›å‡¦ç†**: ãƒ‘ã‚¹â†’3ã¤ã®å„ªå…ˆåº¦åˆ¥çµŒè·¯â†’SIDãƒªã‚¹ãƒˆ
- **æˆ»ã‚Šå€¤**: TableRouteãƒªã‚¹ãƒˆï¼ˆé«˜ãƒ»ä¸­ãƒ»ä½å„ªå…ˆåº¦ã®3ã¤ï¼‰

#### `clear_table_routes(client, table_name)`
- **ç›®çš„**: ãƒ†ãƒ¼ãƒ–ãƒ«å†…ã®å…¨çµŒè·¯ã‚’ã‚¯ãƒªã‚¢
- **å‡¦ç†**: æ—¢å­˜ãƒ«ãƒ¼ãƒˆã‚’å‰Šé™¤ã—ã¦ã‹ã‚‰æ–°ã—ã„ãƒ«ãƒ¼ãƒˆã‚’è¿½åŠ 

#### `update_table_route(client, table_route, is_return=False)`
- **ç›®çš„**: å€‹åˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«çµŒè·¯æ›´æ–°
- **å‡¦ç†**: ip -6 route ã‚³ãƒãƒ³ãƒ‰ã§SRv6ãƒ«ãƒ¼ãƒˆè¨­å®š

#### `update_all_tables(table_routes, is_return=False)`
- **ç›®çš„**: å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ«ãƒ¼ãƒˆã®ä¸€æ‹¬æ›´æ–°
- **å¼•æ•°**: ãƒ«ãƒ¼ãƒˆãƒªã‚¹ãƒˆã€å¾€è·¯/å¾©è·¯ãƒ•ãƒ©ã‚°
- **å‡¦ç†**: å„ãƒ«ãƒ¼ãƒˆã‚’é †æ¬¡æ›´æ–°
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: å¤±æ•—æ™‚ãƒ­ã‚°å‡ºåŠ›

### ğŸ¯ ãƒ¡ã‚¤ãƒ³ã‚¯ãƒ©ã‚¹

#### `SRv6PathManager.__init__(enable_visualization=False)`
- **ç›®çš„**: åŒæ–¹å‘ãƒ‘ã‚¹ç®¡ç†ã®åˆæœŸåŒ–ï¼ˆç°¡ç´ åŒ–ç‰ˆï¼‰
- **ä¾å­˜**: RRDDataManager, PathCalculator, RoutingTableManager, SSHConnectionManager
- **å¯è¦–åŒ–**: TopologyVisualizerã®åˆæœŸåŒ–ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- **è¨­å®š**: åŒæ–¹å‘ãƒ¢ãƒ¼ãƒ‰ï¼ˆr1â‡”r16ï¼‰

#### `SRv6PathManager.update_bidirectional_tables()`
- **ç›®çš„**: åŒæ–¹å‘ã®å‹•çš„ãƒ‘ã‚¹ç®¡ç†å®Ÿè¡Œï¼ˆçµ±åˆæ›´æ–°ãƒ¡ã‚½ãƒƒãƒ‰ï¼‰
- **å‡¦ç†ãƒ•ãƒ­ãƒ¼**: 
  1. RRDãƒ‡ãƒ¼ã‚¿å–å¾—ã¨ã‚¨ãƒƒã‚¸é‡ã¿æ›´æ–°
  2. å¾€è·¯æœ€é©çµŒè·¯è¨ˆç®—ï¼ˆ3çµŒè·¯ã€é‡è¤‡è¨ˆç®—ãªã—ï¼‰
  3. å¾©è·¯çµŒè·¯ã¯å¾€è·¯ã®é€†é †
  4. å¾€è·¯ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°ï¼ˆr1ï¼‰
  5. å¾©è·¯ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°ï¼ˆr16ï¼‰
  6. å¯è¦–åŒ–æ›´æ–°ï¼ˆ--visualizeã‚ªãƒ—ã‚·ãƒ§ãƒ³æœ‰åŠ¹æ™‚ï¼‰
- **å®Ÿè¡Œé–“éš”**: 60ç§’ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ãƒ¢ãƒ¼ãƒ‰ï¼‰

#### `SRv6PathManager.create_table_routes(optimal_path)`
- **ç›®çš„**: å¾€è·¯ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ«ãƒ¼ãƒˆç”Ÿæˆï¼ˆè¨ˆç®—æ¸ˆã¿çµŒè·¯ã®å†åˆ©ç”¨ï¼‰
- **å‡¦ç†**: self.calculated_paths ã‚’ä½¿ç”¨ã—ã¦é‡è¤‡è¨ˆç®—ã‚’æ’é™¤
- **æˆ»ã‚Šå€¤**: TableRouteãƒªã‚¹ãƒˆï¼ˆ3ã¤ï¼‰

#### `SRv6PathManager.visualize_network()`
- **ç›®çš„**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒãƒ­ã‚¸ã¨çµŒè·¯ã‚’å¯è¦–åŒ–
- **å‡¦ç†**: TopologyVisualizer.visualize() ã‚’å‘¼ã³å‡ºã—
- **å‡ºåŠ›**: /opt/app/visualization/topology_latest.png

#### `SRv6RealTimeMultiTableManager.real_time_monitor()`
- **ç›®çš„**: å¾“æ¥ã®å¾€è·¯ã®ã¿ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ï¼ˆäº’æ›æ€§ç¶­æŒï¼‰
- **å‡¦ç†**: ä¸Šè¨˜æ©Ÿèƒ½ã‚¯ãƒ©ã‚¹ã«å‡¦ç†ã‚’å§”è­²
- **å¤‰æ›´æ¤œå‡º**: detect_path_changes()ã«ã‚ˆã‚‹å·®åˆ†ç›£è¦–

## ğŸ”„ æœ€é©åŒ–ãƒ»å¯è¦–åŒ–ã«ã‚ˆã‚‹æ”¹å–„ç‚¹

### âœ… ã‚³ãƒ¼ãƒ‰ã®æ”¹å–„
- **è²¬ä»»åˆ†é›¢**: å˜ä¸€è²¬ä»»åŸå‰‡ã«åŸºã¥ãã‚¯ãƒ©ã‚¹åˆ†å‰²
- **é‡è¤‡æ’é™¤**: è¨ˆç®—æ¸ˆã¿çµŒè·¯ã®å†åˆ©ç”¨ï¼ˆself.calculated_pathsï¼‰ã«ã‚ˆã‚‹é‡è¤‡è¨ˆç®—ã®æ’é™¤
- **ä¿å®ˆæ€§å‘ä¸Š**: å„ã‚¯ãƒ©ã‚¹ãŒç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆå¯èƒ½
- **æ‹¡å¼µæ€§**: æ–°æ©Ÿèƒ½è¿½åŠ æ™‚ã®å½±éŸ¿ç¯„å›²ã‚’é™å®š
- **å¯è¦–åŒ–æ©Ÿèƒ½**: TopologyVisualizerã«ã‚ˆã‚‹ãƒˆãƒãƒ­ã‚¸ã¨çµŒè·¯ã®è¦–è¦šåŒ–

### ğŸš€ å®Ÿè¡ŒåŠ¹ç‡ã®å‘ä¸Š
- **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡**: è¨­å®šæƒ…å ±ã®ä¸€å…ƒç®¡ç†
- **æ¥ç¶šç®¡ç†**: SSHæ¥ç¶šã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼åŒ–
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: å„å±¤ã§ã®é©åˆ‡ãªä¾‹å¤–å‡¦ç†
- **è¨ˆç®—åŠ¹ç‡**: çµŒè·¯è¨ˆç®—ã®çµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦å†åˆ©ç”¨
- **ãƒ­ã‚°æœ€é©åŒ–**: å¾€è·¯ã®ã¿è©³ç´°ãƒ­ã‚°ã€å¾©è·¯ã¯æŠ‘åˆ¶ï¼ˆverboseåˆ¶å¾¡ï¼‰

### ğŸ¨ å¯è¦–åŒ–æ©Ÿèƒ½
- **ãƒˆãƒãƒ­ã‚¸è¡¨ç¤º**: 4x4æ ¼å­çŠ¶ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã§16ãƒãƒ¼ãƒ‰é…ç½®
- **ã‚¨ãƒƒã‚¸æƒ…å ±**: åˆ©ç”¨ç‡ã¨ã‚³ã‚¹ãƒˆã‚’ä¸¡æ–¹è¡¨ç¤º
- **çµŒè·¯è‰²åˆ†ã‘**: é«˜ï¼ˆèµ¤ï¼‰ã€ä¸­ï¼ˆã‚ªãƒ¬ãƒ³ã‚¸ï¼‰ã€ä½ï¼ˆç·‘ï¼‰å„ªå…ˆåº¦
- **ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›**: PNGç”»åƒã¨ã—ã¦ä¿å­˜ï¼ˆGUIãªã—ç’°å¢ƒå¯¾å¿œï¼‰
- **æ›´æ–°å±¥æ­´**: æ›´æ–°å›æ•°ã¨æ™‚åˆ»ã‚’ã‚¿ã‚¤ãƒˆãƒ«ã«è¡¨ç¤º

### ğŸ”§ é‹ç”¨ãƒ¢ãƒ¼ãƒ‰
- **åŒæ–¹å‘ãƒ¢ãƒ¼ãƒ‰**: SRv6PathManagerã«ã‚ˆã‚‹å®Œå…¨ãªr1â‡”r16ç®¡ç† + å¯è¦–åŒ–
- **å¾“æ¥ãƒ¢ãƒ¼ãƒ‰**: SRv6RealTimeMultiTableManagerã«ã‚ˆã‚‹äº’æ›æ€§ç¶­æŒ
- **è§£æãƒ¢ãƒ¼ãƒ‰**: ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°ãªã—ã§ã®çµŒè·¯è¨ˆç®—ç¢ºèª + å¯è¦–åŒ–

## ğŸ’¾ ä¸»è¦ãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆæœ€æ–°ç‰ˆï¼‰

### ğŸ—ï¸ è¨­å®šã‚¯ãƒ©ã‚¹: SRv6Config
```python
@dataclass
class SRv6Config:
    # SSHæ¥ç¶šè¨­å®š
    r1_host: str = "fd02:1::2"
    r16_host: str = "fd02:1::11"
    ssh_port: int = 22
    ssh_user: str = "root"
    ssh_password: str = "@k@n@3>ki"
    
    # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š
    route_prefix: str = "fd03:1::/64"  # r1â†’r16æ–¹å‘
    return_route_prefix: str = "fd00:1::/64"  # r16â†’r1æ–¹å‘ï¼ˆå¾©è·¯ï¼‰
    
    # ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©
    tables: List[Dict[str, str]] = [
        {"name": "rt_table1", "priority": "é«˜å„ªå…ˆåº¦"},
        {"name": "rt_table2", "priority": "ä¸­å„ªå…ˆåº¦"},
        {"name": "rt_table3", "priority": "ä½å„ªå…ˆåº¦"}
    ]
    
    # RRDãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ï¼ˆ24ã‚¨ãƒƒã‚¸ï¼‰
    rrd_paths: Dict[Tuple[int, int], str] = {
        (1, 2): '/opt/app/mrtg/mrtg_file/r1-r2.rrd',
        (1, 3): '/opt/app/mrtg/mrtg_file/r1-r3.rrd',
        # ... ä»–ã®ã‚¨ãƒƒã‚¸
    }
    
    # ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆå¾€è·¯ãƒ»å¾©è·¯ï¼‰
    forward_segments: Dict[int, Dict[int, Tuple[str, str]]]  # {src: {dst: (SID, interface)}}
    return_segments: Dict[int, Dict[int, Tuple[str, str]]]
```

### ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹
```python
@dataclass
class TableRoute:
    table_name: str              # ãƒ†ãƒ¼ãƒ–ãƒ«å
    priority: str                # å„ªå…ˆåº¦ï¼ˆé«˜ãƒ»ä¸­ãƒ»ä½ï¼‰
    path: List[int]              # ãƒãƒ¼ãƒ‰çµŒè·¯
    segments: List[str]          # SRv6ã‚»ã‚°ãƒ¡ãƒ³ãƒˆIDãƒªã‚¹ãƒˆ
    interfaces: List[str]        # å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
    output_interface: str        # æœ€åˆã®ãƒ›ãƒƒãƒ—ã®å‡ºåŠ›ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
    cost: float                  # çµŒè·¯ã‚³ã‚¹ãƒˆ
    description: str             # çµŒè·¯èª¬æ˜

@dataclass
class PathChangeEvent:
    timestamp: str              # ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
    table_name: str             # ãƒ†ãƒ¼ãƒ–ãƒ«å
    old_path: Optional[List[int]]  # æ—§çµŒè·¯
    new_path: List[int]         # æ–°çµŒè·¯
    old_segments: Optional[List[str]]  # æ—§SIDãƒªã‚¹ãƒˆ
    new_segments: List[str]     # æ–°SIDãƒªã‚¹ãƒˆ
    old_interface: Optional[str]  # æ—§å‡ºåŠ›ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
    new_interface: str          # æ–°å‡ºåŠ›ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
    reason: str                 # å¤‰æ›´ç†ç”±
```

### ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒãƒ­ã‚¸ãƒ¼æ§‹é€ 
```python
# NetworkXã‚°ãƒ©ãƒ•ã®ã‚¨ãƒƒã‚¸å®šç¾©ï¼ˆ4x4æ ¼å­çŠ¶ã€16ãƒãƒ¼ãƒ‰ã€24ã‚¨ãƒƒã‚¸ï¼‰
edges = [
    (1, 2, {'weight': 0.0001, 'max_bandwidth': 125_000_000}),
    (1, 3, {'weight': 0.0001, 'max_bandwidth': 125_000_000}),
    (2, 4, {'weight': 0.0001, 'max_bandwidth': 125_000_000}),
    # ... å…¨24ã‚¨ãƒƒã‚¸
]

# RRDãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆå…¨ã‚¨ãƒƒã‚¸ã«å¯¾å¿œï¼‰
rrd_paths = {
    (1, 2): '/opt/app/mrtg/mrtg_file/r1-r2.rrd',
    (1, 3): '/opt/app/mrtg/mrtg_file/r1-r3.rrd',
    (15, 16): '/opt/app/mrtg/mrtg_file/r15-r16.rrd',
    # ... å…¨24ã‚¨ãƒƒã‚¸ã®RRDãƒ‘ã‚¹
}
```

## ğŸ”„ æœ€æ–°ç‰ˆã®å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

### åŒæ–¹å‘ãƒ¢ãƒ¼ãƒ‰ï¼ˆSRv6PathManager + å¯è¦–åŒ–ï¼‰
1. **åˆæœŸåŒ–**
   - å„æ©Ÿèƒ½ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–
   - TopologyVisualizeråˆæœŸåŒ–ï¼ˆ--visualizeã‚ªãƒ—ã‚·ãƒ§ãƒ³æ™‚ï¼‰
   
2. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ«ãƒ¼ãƒ—ï¼ˆ60ç§’é–“éš”ï¼‰**
   - RRDDataManager â†’ ã‚¨ãƒƒã‚¸é‡ã¿æ›´æ–°ï¼ˆåˆ©ç”¨ç‡ãƒ™ãƒ¼ã‚¹ã€æœ€å°é‡ã¿0.0001ï¼‰
   - PathCalculator â†’ r1â†’r16çµŒè·¯è¨ˆç®—ï¼ˆ3çµŒè·¯ã€é‡ã¿å€ç‡é©ç”¨ï¼‰
     - verbose=True: å¾€è·¯ã®è©³ç´°ãƒ­ã‚°å‡ºåŠ›
     - è¨ˆç®—çµæœã‚’self.calculated_pathsã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥
   - SRv6PathManager â†’ TableRouteç”Ÿæˆï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥å†åˆ©ç”¨ã€é‡è¤‡è¨ˆç®—ãªã—ï¼‰
   - SSHConnectionManager â†’ r1ã¸ã®æ¥ç¶š
   - RoutingTableManager â†’ r1ã®ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°ï¼ˆå¾€è·¯ï¼‰
   - PathCalculator â†’ r16â†’r1çµŒè·¯è¨ˆç®—ï¼ˆå¾€è·¯ã®é€†é †ï¼‰
     - verbose=False: å¾©è·¯ã®ãƒ­ã‚°æŠ‘åˆ¶
   - SSHConnectionManager â†’ r16ã¸ã®æ¥ç¶š
   - RoutingTableManager â†’ r16ã®ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°ï¼ˆå¾©è·¯ï¼‰
   - TopologyVisualizer â†’ å¯è¦–åŒ–æ›´æ–°ãƒ»PNGä¿å­˜ï¼ˆ--visualizeã‚ªãƒ—ã‚·ãƒ§ãƒ³æ™‚ï¼‰
   - æ¬¡ã‚µã‚¤ã‚¯ãƒ«ã¾ã§å¾…æ©Ÿ

### å¾“æ¥ãƒ¢ãƒ¼ãƒ‰ï¼ˆSRv6RealTimeMultiTableManagerã€äº’æ›æ€§ç¶­æŒï¼‰
1. **äº’æ›æ€§ç¶­æŒ** â†’ æ—¢å­˜ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ä¿æŒ
2. **å‡¦ç†å§”è­²** â†’ å„æ©Ÿèƒ½ã‚’æ–°ã‚¯ãƒ©ã‚¹ã«å§”è­²
3. **å¤‰æ›´æ¤œå‡º** â†’ detect_path_changes()ã«ã‚ˆã‚‹å·®åˆ†ç®¡ç†

### è§£æãƒ¢ãƒ¼ãƒ‰ï¼ˆ--mode analyzeï¼‰
1. RRDãƒ‡ãƒ¼ã‚¿å–å¾—ã¨ã‚¨ãƒƒã‚¸é‡ã¿æ›´æ–°
2. çµŒè·¯è¨ˆç®—ã®ã¿å®Ÿè¡Œï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°ãªã—ï¼‰
3. å¯è¦–åŒ–ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆï¼ˆ--visualizeã‚ªãƒ—ã‚·ãƒ§ãƒ³æ™‚ï¼‰

## ğŸ¯ æœ€é©åŒ–ã•ã‚ŒãŸã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¨æ©Ÿèƒ½

### è²¬ä»»åˆ†é›¢ã«ã‚ˆã‚‹åŠ¹æœ
- **RRDDataManager**: ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ã®ç‹¬ç«‹æ€§ã€æœ€å°é‡ã¿ä¿è¨¼
- **PathCalculator**: çµŒè·¯è¨ˆç®—ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®å°‚é–€åŒ–ã€é‡ã¿å€ç‡åˆ¶å¾¡
- **TopologyVisualizer**: å¯è¦–åŒ–ãƒ­ã‚¸ãƒƒã‚¯ã®åˆ†é›¢ã€matplotlib Aggå¯¾å¿œ
- **SSHConnectionManager**: æ¥ç¶šç®¡ç†ã®å®‰å…¨æ€§å‘ä¸Š
- **RoutingTableManager**: ãƒ†ãƒ¼ãƒ–ãƒ«æ“ä½œã®çµ±ä¸€åŒ–

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥
- å„ã‚¯ãƒ©ã‚¹ãƒ¬ãƒ™ãƒ«ã§ã®ä¾‹å¤–å‡¦ç†
- SSHæ¥ç¶šã®ç¢ºå®Ÿãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼‰
- RRDãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆæœ€å°é‡ã¿0.0001ï¼‰
- matplotlibè­¦å‘Šã®æŠ‘åˆ¶ï¼ˆæ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆã€Glyphè­¦å‘Šï¼‰

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- çµŒè·¯è¨ˆç®—çµæœã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŒ–ï¼ˆself.calculated_pathsï¼‰
- é‡è¤‡è¨ˆç®—ã®æ’é™¤ï¼ˆcreate_table_routesã§ã®å†è¨ˆç®—é˜²æ­¢ï¼‰
- verboseåˆ¶å¾¡ã«ã‚ˆã‚‹é©åˆ‡ãªãƒ­ã‚°å‡ºåŠ›é‡
- ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ã®ã¿ï¼ˆãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ï¼‰
